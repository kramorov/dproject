{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block content %}
    <div id="content-main">
        <h1>{{ title }}</h1>
        {# –ë–õ–û–ö –û–¢–õ–ê–î–ö–ò –≠–ö–°–ü–û–†–¢–ê - –£–î–ê–õ–ò–¢–¨ –ü–û–°–õ–ï –ü–†–û–í–ï–†–ö–ò #}
        <div style="background: #ffeb3b; padding: 10px; margin: 10px 0; border: 2px solid #ff9800;">
            <h3>üîß –û–¢–õ–ê–î–ö–ê –≠–ö–°–ü–û–†–¢–ê:</h3>
            <p><strong>export_mode:</strong> {{ export_mode|yesno:"–î–ê,–Ω–µ—Ç" }}</p>
            <p><strong>–¢–∏–ø export_mode:</strong> {{ export_mode }} (–∑–Ω–∞—á–µ–Ω–∏–µ)</p>
            <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç—Ä–∏—Ü:</strong> {{ matrices|length }}</p>
            <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:</strong> {{ images|length }}</p>

            {% if matrices %}
                <div style="margin-top: 10px;">
                    <h4>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∞—Ç—Ä–∏—Ü:</h4>
                    {% for matrix in matrices %}
                        <div style="margin: 5px 0; padding: 5px; background: white;">
                            <p><strong>–ú–∞—Ç—Ä–∏—Ü–∞ {{ forloop.counter }}:</strong> PN={{ matrix.pn }},
                                —Å—Ç—Ä–æ–∫={{ matrix.matrix|length }}</p>
                            {% if matrix.matrix %}
                                <p><strong>–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ (–∑–∞–≥–æ–ª–æ–≤–∫–∏):</strong> {{ matrix.matrix.0 }}</p>
                                {% if matrix.matrix.1 %}
                                    <p><strong>–í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ (–¥–∞–Ω–Ω—ã–µ):</strong> {{ matrix.matrix.1 }}</p>
                                {% endif %}
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        {# –ö–û–ù–ï–¶ –ë–õ–û–ö–ê –û–¢–õ–ê–î–ö–ò #}
        <div class="module">
            <h2>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <table>
                <tr>
                    <th>–¢–∞–±–ª–∏—Ü–∞:</th>
                    <td>{{ table_info.name|default:"-" }}</td>
                </tr>
                <tr>
                    <th>–ö–æ–¥ —Ç–∞–±–ª–∏—Ü—ã:</th>
                    <td>{{ table_info.code|default:"-" }}</td>
                </tr>
                <tr>
                    <th>–û–ø–∏—Å–∞–Ω–∏–µ:</th>
                    <td>{{ table_info.description|default:"-" }}</td>
                </tr>
                <tr>
                    <th>–ë—Ä–µ–Ω–¥:</th>
                    <td>{{ table_info.valve_brand|default:"-" }}</td>
                </tr>
                <tr>
                    <th>–¢–∏–ø –∞—Ä–º–∞—Ç—É—Ä—ã:</th>
                    <td>{{ table_info.valve_variety|default:"-" }}</td>
                </tr>
            </table>
        </div>

        {% if images %}
            <div class="module">
                <h2>–ß–µ—Ä—Ç–µ–∂–∏</h2>
                <div class="form-row">
                    {% for image in images %}
                        <div class="field-box">
                            <h4>{{ image.drawing_title }}</h4>
                            <p>{{ image.drawing_description|default:"-" }}</p>
                            {% if image.drawing_object and image.drawing_object.media_file %}
                                <div style="margin: 10px 0;">
                                    <img src="{{ image.drawing_object.media_file.url }}"
                                         style="max-width: 300px; max-height: 200px;"
                                         alt="{{ image.drawing_title }}">
                                </div>
                            {% endif %}
                            {% if image.matching_dns %}
                                <p><small>–ü—Ä–∏–º–µ–Ω–∏–º–æ –¥–ª—è DN: {{ image.matching_dns|join:", " }}</small></p>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        {% for matrix_data in matrices %}
            <div class="module">
                <h2>–¢–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è PN: {{ matrix_data.pn }}</h2>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                        <thead>
                        <tr style="background-color: #f5f5f5;">
                            {# –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º - –ò–°–ü–†–ê–í–õ–ï–ù–ê –°–¢–†–£–ö–¢–£–†–ê #}
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">PN</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">–ö–æ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">–û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
                            </th>
                            {# –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ DN #}
                            {% for row in matrix_data.matrix %}
                                {% if forloop.first %}
                                    {# –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—ã–µ 2 –∫–æ–ª–æ–Ω–∫–∏ (legend, parameter_variety_name) #}
                                    {% for header in row %}
                                        {% if forloop.counter > 2 %}
                                            <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                                                DN{{ header }}</th>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                        </tr>
                        </thead>
                        <tbody>
                        {% for row in matrix_data.matrix %}
                            {% if not forloop.first %} {# –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É - —ç—Ç–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ #}
                                <tr>
                                    {# PN –±–µ—Ä–µ–º –∏–∑ matrix_data.pn #}
                                    <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">{{ matrix_data.pn }}</td>
                                    {# –ö–æ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ - –ø–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ #}
                                    <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">{{ row.0|default:"" }}</td>
                                    {# –û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ - –≤—Ç–æ—Ä–∞—è –∫–æ–ª–æ–Ω–∫–∞ #}
                                    <td style="border: 1px solid #ddd; padding: 6px;">{{ row.1|default:"" }}</td>
                                    {# –ó–Ω–∞—á–µ–Ω–∏—è DN - –Ω–∞—á–∏–Ω–∞—è —Å —Ç—Ä–µ—Ç—å–µ–π –∫–æ–ª–æ–Ω–∫–∏ #}
                                    {% for value in row %}
                                        {% if forloop.counter > 2 %}
                                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">{{ value|default:"–Ω/–¥" }}</td>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                            {% endif %}
                        {% empty %}
                            <tr>
                                <td colspan="100" style="text-align: center; padding: 20px;">
                                    –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        {% empty %}
            <div class="module">
                <h2>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h2>
                <p>–î–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ –í–ì–•.</p>
            </div>
        {% endfor %}

    </div>

    <style>
        .module {
            margin-bottom: 20px;
            border: 1px solid #ccc;
            background: white;
        }

        .module h2 {
            margin: 0;
            padding: 8px;
            font-size: 14px;
            background: #79aec8;
            color: white;
        }

        .field-box {
            float: left;
            width: 300px;
            margin-right: 20px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            padding: 10px;
            background: #f9f9f9;
        }

        .form-row:after {
            content: "";
            display: table;
            clear: both;
        }
    </style>

{% endblock %}