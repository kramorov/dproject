Страница просмотра списка запросов клиентов и выбора запроса для редактирования, добавления нового или удаления старого.
Старый запрос не удаляется, у него меняется статус на неактуальный
Статусы запросов:
Новый
В работе
Обработан
Архив
Удаленный
Добавить текстовое поле "Текст запроса" для хранения текста запроса в форматированном виде (копированием из почты или ворд) - HTML поле?

Фильтры:
Статус запроса
Компания-клиент
Контактное лицо
Тип запроса - "Подбор арматуры", "Подбор электропривода"...
Дата от, дата до...
Текстовое поле - из него осуществляется поиск по подстроке из текстового представления названия компании, ФИО контактного лица
названия запроса, номера ОЛ. Если это фильтр задействован, но строковом представлении запроса в соответствующих полях
эта подстрока выделяется цветом.

Кнопки:
Добавить запрос - добавляет новый запрос, записывает его сразу в БД
Копировать запрос - добавляет новый запрос, копируя реквизиты шапки запроса. Строки запроса при этому не копируются.
Удалить запрос - переводит запрос в статус "Удаленный". Просмотр удаленных запросов доступен только администратору.
Редактировать запрос - открывает форму редактирования запроса.

Один клик по строке запроса ставит/снимает выбор.
Если строка выбрана, делаются активны кнопки "Копировать", "Удалить", "Редактировать".
"Добавить" активна всегда
При двойном клике на строку запроса открывается окно редактирования запроса.

Форма списка состоит из самого списка и подвала. Содержимое подвала отображается, если запрос выбран и у него есть строки
Если запрос выбран, а строк у него нет - отображается надпись "Нет строк"
Строки запроса выводятся в верхней части.
Кнопки выводятся над ними в блоке "Кнопки".
Каждая строка запроса выводится блоком из двух строк.
Первая строка: Id запроса, тип запроса, название запроса, дата запроса
Вторая строка: Компания, Ответственное лицо

Подвал состоит из блоков строк
1. Требования ( к арматуре или приводу)
2. Подбор(ы) к каждому требованию требованиям.

Если это требования к арматуре
Первая строка: номер строки (линии) в запросе, тип арматуры, ДН, РН, требуемый момент, время закрытия, Производитель, Артикул производителя
Поместить эту функцию в модель требований. Для
Строковые версии получаем

Результатом подбора по требованию к арматуре будет один или несколько вариантов подбора (разных производителей)
В подборе по арматуре будет указываться либо данные из справочника арматуры, либо вноситься вручную.
Каждому подбору по арматуре будет соответствовать один или несколько вариантов подборов приводов,
например к дисковому затвору можно предложить четвертьоборотный электропривод или многооборотный. Клиенту можно
предлагать разные варианты подбора. Поэтому в подборе надо поле "Действует / Не актуально".
Собственно, требования нужны только для сравнения подбора с требованиями, и для ограничения выбора или вывода подсказок в форме подбора.

Простой сценарий подбора электропривода к запросу ФОБОС:
требований к арматуре нет, нам сообщают Тип (КШ) ДН, РН, время - все это можно взять из данных на арматуру
Требования к приводу есть.
То есть, у нас есть готовый подбор арматуры. На основании подбора арматуры делается подбор привода, он привязывается к подобранной арматуре

Строка 1 шапка.
Подчиненные:
Требования к арматуре (могут быть, могут не быть)
Требования к приводу (есть всегда - напряжение, усилие)
    Подбор арматуры 1
        Подбор привода 1.1
        Подбор привода 1.2
    Подбор арматуры 2
        Подбор привода 2.1
        Подбор привода 2.2


Запрос - шапка запроса. Состоит из основной инфо по запросу
Запрос может быть нескольких типов:
"Подбор арматуры (без привода)"
"Подбор арматуры и электропривода"
"Подбор арматуры и пневмопривода"
"Подбор электропривода к арматуре заказчика"
"Подбор пневмопривода к арматуре заказчика"
"Подбор электропривода по требованиям заказчика (данные по арматуре неизвестны)"
"Подбор пневмопривода по требованиям заказчика (данные по арматуре неизвестны)"

Запрос состоит из нескольких строк
Каждая строка запроса состоит из:
1. требований заказчика, которые могут быть указаны в тексте запроса, или в ОЛ
2. И подбором оборудования по этим требованиям
В требованиях перечисляются абстрактные требования по ОЛ
В подборе указывается конкретное оборудования, с выбранными опциями.

Поля строки запроса: (RequestLine/Item):
pk - UUID
parent_request_id - ссылка UUID
line_no - порядковый номер строки в таблице запроса (сделать механизм перенумерации строк)

Требования заказчика могут быть сформулированы к арматуре, электроприводу, пневмоприводу.
Требования есть нескольких типов:
"Требования к арматуре"
"Требования к электроприводу, адаптации"
"Требования к пневмоприводу, адаптации, обвязке"

Поля требований: (AbstractRequirent):
pk - UUID
Может, предусмотреть ссылку на сам запрос - для быстрого выбора всех подчиненных элементов?
parent_request_line_id - ссылка на строку запроса (UUID)
parent_request_line_no - порядковый номер строки запроса (int)
requirement_type - к чему относятся требования - арматура / привод электро / привод пневмо


Подбор также может быть по арматуре, электроприводу, пневмоприводу.
Строки подбора есть нескольких типов:
"Подбор арматуры"
"Подбор электропривода"
"Подбор пневмопривода"

Поля Подбора: (AbstractSelection):
pk - UUID
Может, предусмотреть ссылку на сам запрос - для быстрого выбора всех подчиненных элементов?
parent_request_line_id - ссылка на строку запроса (UUID)
parent_requirement_id - ссылка на запись требований (UUID). Кстати, а как определять, к какому типу требований подбор?
selection_type - к чему относятся требования - арматура / привод

Как будет выглядеть выборка:
выбираем строки запроса по полю parent_request_id== id

При создании строки запроса одновременно создаются подчиненные строки, в зависимости от типа запроса:
"Подбор арматуры (без привода)"
    "Требования к арматуре ПОЛНЫЕ"
        "Подбор арматуры"
"Подбор арматуры и электропривода"
    "Требования к арматуре ПОЛНЫЕ"
    "Требования к электроприводу, адаптации"
        "Подбор арматуры"
        "Подбор электропривода"
"Подбор арматуры и пневмопривода"
    "Требования к арматуре ПОЛНЫЕ"
    "Требования к пневмоприводу, адаптации, обвязке"
        "Подбор арматуры"
        "Подбор пневмопривода"
"Подбор электропривода к арматуре заказчика"
    "Требования к арматуре БАЗОВЫЕ"
    "Требования к электроприводу, адаптации"
        "Подбор электропривода"
"Подбор пневмопривода к арматуре заказчика"
    "Требования к арматуре БАЗОВЫЕ"
    "Требования к пневмоприводу, адаптации, обвязке"
        "Подбор пневмопривода"
"Подбор электропривода по требованиям заказчика (данные по арматуре неизвестны)"
    "Требования к электроприводу, адаптации"
        "Подбор электропривода"
"Подбор пневмопривода по требованиям заказчика (данные по арматуре неизвестны)"
    "Требования к пневмоприводу, адаптации, обвязке"
        "Подбор пневмопривода"

Требования к приводам базируются на требованиях к арматуре. Таким образом, нужно сформулировать БАЗОВЫЕ
требования к арматуре и их привязку к требованиям на привод.
Можно сказать, что БАЗОВЫЕ требования - это то, что относится к приводу:
- тип привода (может быть и не указан)
- требуемый момент
- требуемая скорость
- адаптации к арматуре.

Параметр Exd действует на все компоненты требований - при его установке такие требования должны быть установлены во всех компонентах

Требования подбора БКВ, распреда, ФР, позиционера могут быть указаны, а могут и нет. Поэтому имеет смысл ввести поля в требования
есть такое требование или нет, и делать отдельные требования (подчиненные)


Результатом подбора будет:
1. Сравнение требований с фактическим подбором
2. Генерация документации по каждому подбору
3. Генерация коммерческого предложения

таким образом, каждой строке запроса подчинены несколько строк требований (в зависимости от типа запроса), а также несколько строк подборов


Строка подбора подчиняется

Строки запроса:

Возвращает:
Список текстовых заголовков и их id - для вывода и фильтрации списка (модель  ClientRequest)
Полные данные конкретного запроса по id (сама модель  ClientRequest)
Список строк конкретного запроса вместе с подчиненными строками требований по id (сама модель  ClientRequest)
